-- 会员管理模块测试数据插入脚本
-- 基于网页显示的数据创建相应的测试数据

USE omniperform;

-- 1. 插入会员基础信息数据
-- 根据网页显示：总会员数 6,750
INSERT INTO member_info (member_code, member_name, phone, baby_stage, registration_date, last_interaction_time, status, guide_id, region_code, registration_source) VALUES
-- 高价值会员样本
('M20251101', '张丽华', '13812341234', '1阶段', '2024-10-15 10:00:00', '2025-01-13 15:30:00', 1, 1, 'SH', 'wechat'),
('M20251102', '李美玲', '13956785678', '0阶段', '2024-12-20 14:20:00', '2025-01-10 09:15:00', 1, 2, 'BJ', 'app'),
('M20251103', '赵雅琴', '13612341011', '2阶段', '2024-08-10 16:45:00', '2025-01-14 11:20:00', 1, 3, 'GZ', 'offline'),
-- 潜力会员样本
('M20251104', '王晓敏', '13798769876', '3阶段', '2024-06-15 12:30:00', '2024-12-10 14:45:00', 1, 1, 'SZ', 'wechat'),
('M20251105', '刘慧敏', '13512131213', '4阶段', '2024-03-20 09:15:00', '2024-11-05 16:30:00', 2, 4, 'HZ', 'referral'),
-- 新会员样本
('M20251106', '陈思雨', '13888888001', '0阶段', '2025-01-01 08:30:00', '2025-01-14 10:15:00', 1, 5, 'CD', 'wechat'),
('M20251107', '周美丽', '13888888002', '1阶段', '2025-01-05 11:20:00', '2025-01-13 14:30:00', 1, 1, 'CQ', 'app'),
-- 沉默会员样本
('M20251108', '孙雅静', '13666666500', '2阶段', '2024-05-10 15:45:00', '2024-10-15 12:20:00', 2, 2, 'XA', 'offline'),
('M20251109', '吴丽娜', '13777777600', '3阶段', '2024-04-01 13:15:00', '2024-09-20 16:45:00', 2, 3, 'NJ', 'wechat'),
-- 流失会员样本
('M20251110', '马晓红', '13555555000', '4阶段', '2023-12-01 10:30:00', '2024-06-01 14:20:00', 3, 4, 'WH', 'referral');

-- 2. 插入会员月度统计数据
-- 2025年7月数据（当前月份）
INSERT INTO member_monthly_statistics (stat_month, total_members, active_members, new_members, lost_members, repeat_purchase_rate, avg_purchase_amount, total_purchase_amount, total_interactions, region_code) VALUES
('2025-07', 6750, 4400, 1285, 350, 68.50, 285.75, 1950000.00, 12850, 'CN'),
('2025-06', 5465, 3850, 980, 280, 65.20, 268.90, 1680000.00, 10950, 'CN'),
('2025-05', 4485, 3200, 850, 220, 62.80, 245.60, 1420000.00, 9650, 'CN');

-- 3. 插入会员生命周期记录
-- 根据网页显示的生命周期分布数据
INSERT INTO member_lifecycle_records (member_id, lifecycle_stage, stage_start_date, stage_end_date, days_in_stage, trigger_event, stage_description) VALUES
-- 导入期会员 (850人)
(26, '导入期', '2025-01-01', NULL, 14, '新会员注册', '新注册会员，正在了解产品'),
(27, '导入期', '2025-01-05', NULL, 10, '新会员注册', '新注册会员，正在了解产品'),
-- 成长期会员 (1520人)
(22, '成长期', '2024-12-20', NULL, 25, '首次购买', '开始购买产品，建立信任关系'),
-- 成熟期会员 (2030人)
(21, '成熟期', '2024-10-15', NULL, 91, '复购行为', '稳定购买，高度信任品牌'),
(23, '成熟期', '2024-08-10', NULL, 157, '复购行为', '稳定购买，高度信任品牌'),
-- 衰退期会员 (1350人)
(24, '衰退期', '2024-06-15', NULL, 213, '购买频次下降', '购买行为减少，需要关怀'),
(28, '衰退期', '2024-05-10', NULL, 248, '购买频次下降', '购买行为减少，需要关怀'),
-- 流失期会员 (1000人)
(25, '流失期', '2024-03-20', NULL, 299, '长期无购买', '超过6个月无购买行为'),
(30, '流失期', '2023-12-01', NULL, 409, '长期无购买', '超过6个月无购买行为');

-- 4. 插入CRFM-E评分数据
-- 根据网页显示的评分分布：0-20(500), 21-40(800), 41-60(2500), 61-80(2100), 81-100(850)
INSERT INTO member_crfme_scores (member_id, score_month, c_score, r_score, f_score, m_score, e_score, total_score, score_level, calculation_date) VALUES
-- 高分组 (81-100分，850人)
(21, '2025-07', 18.0, 17.0, 16.0, 18.0, 16.0, 85.0, 'excellent', '2025-07-15'),
(23, '2025-07', 19.0, 18.0, 17.0, 19.0, 18.0, 91.0, 'excellent', '2025-07-15'),
-- 中高分组 (61-80分，2100人)
(22, '2025-07', 15.0, 14.0, 13.0, 15.0, 15.0, 72.0, 'good', '2025-07-15'),
(26, '2025-07', 16.0, 15.0, 14.0, 16.0, 14.0, 75.0, 'good', '2025-07-15'),
(27, '2025-07', 16.0, 16.0, 15.0, 15.0, 16.0, 78.0, 'good', '2025-07-15'),
-- 中等分组 (41-60分，2500人)
(24, '2025-07', 10.0, 9.0, 8.0, 9.0, 9.0, 45.0, 'average', '2025-07-15'),
(28, '2025-07', 8.0, 7.0, 8.0, 8.0, 7.0, 38.0, 'average', '2025-07-15'),
-- 低分组 (21-40分，800人)
(25, '2025-07', 7.0, 6.0, 6.0, 7.0, 6.0, 32.0, 'poor', '2025-07-15'),
-- 最低分组 (0-20分，500人)
(30, '2025-07', 5.0, 5.0, 5.0, 5.0, 5.0, 25.0, 'very_poor', '2025-07-15');

-- 5. 插入会员分层数据
-- 根据网页显示的分层数据
INSERT INTO member_segmentation (member_id, segment_month, segment_type, segment_criteria, segment_strategy, entry_date, exit_date, is_current) VALUES
-- 高价值会员 (850人)
(21, '2025-01', '高价值会员', 'CRFM-E > 80', '专属客服、新品优先体验、生日特殊礼遇', '2025-01-15', NULL, 1),
(23, '2025-01', '高价值会员', 'CRFM-E > 80', '专属客服、新品优先体验、生日特殊礼遇', '2025-01-15', NULL, 1),
-- 潜力会员 (2100人)
(22, '2025-01', '潜力会员', 'CRFM-E 60-80', '阶段性关怀、复购提醒、优惠券激励', '2025-01-15', NULL, 1),
(26, '2025-01', '潜力会员', 'CRFM-E 60-80', '阶段性关怀、复购提醒、优惠券激励', '2025-01-15', NULL, 1),
(27, '2025-01', '潜力会员', 'CRFM-E 60-80', '阶段性关怀、复购提醒、优惠券激励', '2025-01-15', NULL, 1),
-- 新会员 (1285人)
(26, '2025-01', '新会员', '注册30天内', '欢迎礼包、信息完善引导、首购优惠', '2025-01-01', NULL, 1),
(27, '2025-01', '新会员', '注册30天内', '欢迎礼包、信息完善引导、首购优惠', '2025-01-05', NULL, 1),
-- 沉默会员 (1850人)
(28, '2025-01', '沉默会员', '90天未互动', '唤醒关怀短信、专属优惠券、调研问卷', '2024-10-15', NULL, 1),
(29, '2025-01', '沉默会员', '90天未互动', '唤醒关怀短信、专属优惠券、调研问卷', '2024-09-20', NULL, 1);

-- 6. 插入会员活动记录
INSERT INTO member_activity_logs (member_id, activity_type, activity_detail, activity_value, activity_date, source_channel, guide_id, region_code) VALUES
-- 高价值会员的活动记录
(21, 'purchase', '购买启赋3段奶粉2罐', 450.00, '2025-01-13', 'wechat', 1, 'CN'),
(21, 'consultation', '咨询宝宝辅食添加问题', 0.00, '2025-01-12', 'wechat', 1, 'CN'),
(23, 'purchase', '购买启赋2段奶粉3罐', 675.00, '2025-01-14', 'app', 3, 'CN'),
(23, 'activity_participation', '参与育儿知识竞答活动', 10.00, '2025-01-13', 'app', 3, 'CN'),
-- 潜力会员的活动记录
(22, 'consultation', '咨询孕期营养补充', 0.00, '2025-01-10', 'phone', 2, 'CN'),
(26, 'registration', '完成会员注册', 0.00, '2025-01-01', 'wechat', 5, 'CN'),
(27, 'first_purchase', '首次购买启赋1段奶粉', 225.00, '2025-01-08', 'app', 1, 'CN'),
-- 沉默会员的活动记录
(24, 'consultation', '咨询宝宝睡眠问题', 0.00, '2024-12-10', 'wechat', 1, 'CN'),
(28, 'browse', '浏览育儿知识文章', 0.00, '2024-10-15', 'app', NULL, 'CN'),
-- 流失会员的活动记录
(25, 'consultation', '咨询产品使用方法', 0.00, '2024-11-05', 'phone', 4, 'CN');

-- 7. 插入会员月度阶段统计数据
-- 2025年7月的各阶段统计
INSERT INTO member_stage_monthly_stats (stat_month, baby_stage, member_count, new_members, active_members, purchase_amount, avg_crfme_score, region_code) VALUES
-- 2025年7月数据
('2025-07', '导入期', 850, 285, 680, 125000.00, 65.8, 'CN'),
('2025-07', '成长期', 1520, 480, 1380, 285000.00, 72.5, 'CN'),
('2025-07', '成熟期', 2030, 320, 2200, 680000.00, 78.2, 'CN'),
('2025-07', '衰退期', 1350, 150, 850, 180000.00, 58.9, 'CN'),
('2025-07', '流失期', 1000, 50, 290, 45000.00, 42.1, 'CN'),
-- 2025年6月数据
('2025-06', '导入期', 720, 220, 580, 98000.00, 63.2, 'CN'),
('2025-06', '成长期', 1280, 380, 1180, 245000.00, 70.1, 'CN'),
('2025-06', '成熟期', 1650, 280, 1850, 580000.00, 76.8, 'CN'),
('2025-06', '衰退期', 1095, 120, 720, 155000.00, 56.5, 'CN'),
('2025-06', '流失期', 720, 40, 240, 38000.00, 40.8, 'CN'),
-- 2025年5月数据
('2025-05', '导入期', 580, 180, 520, 85000.00, 61.8, 'CN'),
('2025-05', '成长期', 1050, 320, 1050, 220000.00, 68.5, 'CN'),
('2025-05', '成熟期', 1380, 250, 1680, 520000.00, 75.2, 'CN'),
('2025-05', '衰退期', 895, 100, 580, 135000.00, 54.8, 'CN'),
('2025-05', '流失期', 580, 30, 180, 32000.00, 38.9, 'CN');

COMMIT;

-- 验证数据插入结果
SELECT '会员基础信息表' as table_name, COUNT(*) as record_count FROM member_info
UNION ALL
SELECT '会员月度统计表', COUNT(*) FROM member_monthly_statistics
UNION ALL
SELECT '会员生命周期记录表', COUNT(*) FROM member_lifecycle_records
UNION ALL
SELECT 'CRFM-E评分表', COUNT(*) FROM member_crfme_scores
UNION ALL
SELECT '会员分层表', COUNT(*) FROM member_segmentation
UNION ALL
SELECT '会员活动记录表', COUNT(*) FROM member_activity_logs
UNION ALL
SELECT '会员月度阶段统计表', COUNT(*) FROM member_stage_monthly_stats;

-- 验证关键数据统计
SELECT 
    '总会员数' as metric,
    COUNT(*) as value
FROM member_info
UNION ALL
SELECT 
    '活跃会员数',
    COUNT(*)
FROM member_info 
WHERE status = 1
UNION ALL
SELECT 
    '本月新增会员数',
    COUNT(*)
FROM member_info 
WHERE registration_date >= '2025-01-01';