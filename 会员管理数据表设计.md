# 会员管理模块数据表设计

## 概述

基于会员管理页面的功能需求分析，会员管理模块需要支持以下核心功能：
- 会员概览统计（总会员数、活跃会员、新增会员、复购率等）
- 会员生命周期管理（导入期、成长期、成熟期、衰退期、流失期）
- 会员分层运营（基于CRFM-E模型的价值分层）
- CRFM-E模型评分分析
- 月度数据查询和统计

## 数据表设计

### 1. 会员基础信息表 (member_info)

**表名**: `member_info`
**用途**: 存储会员的基本信息和属性

```sql
CREATE TABLE member_info (
    member_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '会员ID',
    member_code VARCHAR(50) UNIQUE NOT NULL COMMENT '会员编号',
    member_name VARCHAR(100) NOT NULL COMMENT '会员姓名',
    phone VARCHAR(20) COMMENT '手机号码',
    email VARCHAR(100) COMMENT '邮箱地址',
    gender TINYINT COMMENT '性别：1-男，2-女',
    birth_date DATE COMMENT '出生日期',
    baby_birth_date DATE COMMENT '宝宝出生日期',
    baby_stage VARCHAR(20) COMMENT '宝宝阶段：孕期、0-6月、6-12月、12-24月、24月+',
    registration_date DATETIME NOT NULL COMMENT '注册时间',
    registration_source VARCHAR(50) COMMENT '注册来源：线下门店、线上商城、微信小程序、APP等',
    guide_id BIGINT COMMENT '专属导购ID',
    region_code VARCHAR(20) COMMENT '所属区域代码',
    city VARCHAR(50) COMMENT '所在城市',
    status TINYINT DEFAULT 1 COMMENT '状态：1-正常，2-冻结，3-注销',
    last_login_time DATETIME COMMENT '最后登录时间',
    last_purchase_time DATETIME COMMENT '最后购买时间',
    last_interaction_time DATETIME COMMENT '最后互动时间',
    total_purchase_amount DECIMAL(10,2) DEFAULT 0 COMMENT '累计购买金额',
    total_purchase_count INT DEFAULT 0 COMMENT '累计购买次数',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_member_code (member_code),
    INDEX idx_phone (phone),
    INDEX idx_baby_stage (baby_stage),
    INDEX idx_registration_date (registration_date),
    INDEX idx_guide_id (guide_id),
    INDEX idx_region_code (region_code)
) COMMENT='会员基础信息表';
```

### 2. 会员月度统计表 (member_monthly_statistics)

**表名**: `member_monthly_statistics`
**用途**: 存储每月的会员统计数据，支持月度查询

```sql
CREATE TABLE member_monthly_statistics (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    stat_month VARCHAR(7) NOT NULL COMMENT '统计月份，格式：YYYY-MM',
    total_members INT DEFAULT 0 COMMENT '总会员数',
    active_members INT DEFAULT 0 COMMENT '活跃会员数（当月有互动）',
    new_members INT DEFAULT 0 COMMENT '新增会员数',
    lost_members INT DEFAULT 0 COMMENT '流失会员数',
    repeat_purchase_rate DECIMAL(5,2) DEFAULT 0 COMMENT '复购率（%）',
    avg_purchase_amount DECIMAL(10,2) DEFAULT 0 COMMENT '平均购买金额',
    total_purchase_amount DECIMAL(15,2) DEFAULT 0 COMMENT '总购买金额',
    total_interactions INT DEFAULT 0 COMMENT '总互动次数',
    region_code VARCHAR(20) COMMENT '区域代码，NULL表示全国统计',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_month_region (stat_month, region_code),
    INDEX idx_stat_month (stat_month),
    INDEX idx_region_code (region_code)
) COMMENT='会员月度统计表';
```

### 3. 会员生命周期记录表 (member_lifecycle_records)

**表名**: `member_lifecycle_records`
**用途**: 记录会员生命周期变化历史

```sql
CREATE TABLE member_lifecycle_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    member_id BIGINT NOT NULL COMMENT '会员ID',
    lifecycle_stage VARCHAR(20) NOT NULL COMMENT '生命周期阶段：导入期、成长期、成熟期、衰退期、流失期',
    stage_start_date DATETIME NOT NULL COMMENT '阶段开始时间',
    stage_end_date DATETIME COMMENT '阶段结束时间',
    days_in_stage INT COMMENT '在该阶段停留天数',
    trigger_event VARCHAR(100) COMMENT '触发阶段变化的事件',
    stage_description TEXT COMMENT '阶段描述',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    INDEX idx_member_id (member_id),
    INDEX idx_lifecycle_stage (lifecycle_stage),
    INDEX idx_stage_start_date (stage_start_date),
    FOREIGN KEY (member_id) REFERENCES member_info(member_id)
) COMMENT='会员生命周期记录表';
```

### 4. CRFM-E评分表 (member_crfme_scores)

**表名**: `member_crfme_scores`
**用途**: 存储会员CRFM-E模型各维度评分

```sql
CREATE TABLE member_crfme_scores (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    member_id BIGINT NOT NULL COMMENT '会员ID',
    score_month VARCHAR(7) NOT NULL COMMENT '评分月份，格式：YYYY-MM',
    c_score DECIMAL(5,2) DEFAULT 0 COMMENT 'C维度评分：宝宝成长阶段匹配度',
    r_score DECIMAL(5,2) DEFAULT 0 COMMENT 'R维度评分：关系深度',
    f_score DECIMAL(5,2) DEFAULT 0 COMMENT 'F维度评分：功能参与度',
    m_score DECIMAL(5,2) DEFAULT 0 COMMENT 'M维度评分：多维价值',
    e_score DECIMAL(5,2) DEFAULT 0 COMMENT 'E维度评分：情感连接',
    total_score DECIMAL(5,2) DEFAULT 0 COMMENT '总评分',
    score_level VARCHAR(20) COMMENT '评分等级：高价值、潜力、普通、低价值',
    calculation_date DATETIME NOT NULL COMMENT '计算时间',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_member_month (member_id, score_month),
    INDEX idx_score_month (score_month),
    INDEX idx_total_score (total_score),
    INDEX idx_score_level (score_level),
    FOREIGN KEY (member_id) REFERENCES member_info(member_id)
) COMMENT='CRFM-E评分表';
```

### 5. 会员分层表 (member_segmentation)

**表名**: `member_segmentation`
**用途**: 存储会员分层运营信息

```sql
CREATE TABLE member_segmentation (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    member_id BIGINT NOT NULL COMMENT '会员ID',
    segment_month VARCHAR(7) NOT NULL COMMENT '分层月份，格式：YYYY-MM',
    segment_type VARCHAR(50) NOT NULL COMMENT '分层类型：高价值会员、潜力会员、新会员、沉默会员等',
    segment_criteria TEXT COMMENT '分层标准描述',
    segment_strategy TEXT COMMENT '运营策略',
    entry_date DATETIME NOT NULL COMMENT '进入该分层时间',
    exit_date DATETIME COMMENT '离开该分层时间',
    is_current TINYINT DEFAULT 1 COMMENT '是否当前分层：1-是，0-否',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_member_id (member_id),
    INDEX idx_segment_month (segment_month),
    INDEX idx_segment_type (segment_type),
    INDEX idx_is_current (is_current),
    FOREIGN KEY (member_id) REFERENCES member_info(member_id)
) COMMENT='会员分层表';
```

### 6. 会员活动记录表 (member_activity_logs)

**表名**: `member_activity_logs`
**用途**: 记录会员的各种活动和互动行为

```sql
CREATE TABLE member_activity_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    member_id BIGINT NOT NULL COMMENT '会员ID',
    activity_type VARCHAR(50) NOT NULL COMMENT '活动类型：登录、购买、浏览、互动、签到等',
    activity_detail TEXT COMMENT '活动详情',
    activity_value DECIMAL(10,2) COMMENT '活动价值（如购买金额）',
    activity_date DATETIME NOT NULL COMMENT '活动时间',
    source_channel VARCHAR(50) COMMENT '来源渠道',
    guide_id BIGINT COMMENT '相关导购ID',
    region_code VARCHAR(20) COMMENT '区域代码',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    INDEX idx_member_id (member_id),
    INDEX idx_activity_type (activity_type),
    INDEX idx_activity_date (activity_date),
    INDEX idx_guide_id (guide_id),
    INDEX idx_region_code (region_code),
    FOREIGN KEY (member_id) REFERENCES member_info(member_id)
) COMMENT='会员活动记录表';
```

### 7. 会员月度阶段统计表 (member_stage_monthly_stats)

**表名**: `member_stage_monthly_stats`
**用途**: 存储每月各宝宝阶段的会员统计数据

```sql
CREATE TABLE member_stage_monthly_stats (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    stat_month VARCHAR(7) NOT NULL COMMENT '统计月份，格式：YYYY-MM',
    baby_stage VARCHAR(20) NOT NULL COMMENT '宝宝阶段',
    member_count INT DEFAULT 0 COMMENT '该阶段会员数量',
    new_members INT DEFAULT 0 COMMENT '新增会员数',
    active_members INT DEFAULT 0 COMMENT '活跃会员数',
    purchase_amount DECIMAL(15,2) DEFAULT 0 COMMENT '购买金额',
    avg_crfme_score DECIMAL(5,2) DEFAULT 0 COMMENT '平均CRFM-E评分',
    region_code VARCHAR(20) COMMENT '区域代码，NULL表示全国统计',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_month_stage_region (stat_month, baby_stage, region_code),
    INDEX idx_stat_month (stat_month),
    INDEX idx_baby_stage (baby_stage),
    INDEX idx_region_code (region_code)
) COMMENT='会员月度阶段统计表';
```

## 数据表关系说明

1. **核心表**: `member_info` 是核心表，存储会员基础信息
2. **统计表**: `member_monthly_statistics` 和 `member_stage_monthly_stats` 用于月度统计查询
3. **历史记录表**: `member_lifecycle_records` 和 `member_activity_logs` 记录会员行为历史
4. **评分表**: `member_crfme_scores` 存储CRFM-E模型评分
5. **分层表**: `member_segmentation` 管理会员分层信息

## 月度查询支持

所有涉及时间维度的表都包含月份字段（格式：YYYY-MM），支持：
- 按月查询会员统计数据
- 按月查询CRFM-E评分变化
- 按月查询会员分层变化
- 按月查询各宝宝阶段分布

## 索引设计

- 主键索引：所有表都有自增主键
- 唯一索引：防止重复数据（如会员编号、月度统计等）
- 普通索引：优化常用查询字段（月份、会员ID、区域等）
- 外键索引：保证数据完整性

## 数据量估算

假设系统有10万会员：
- `member_info`: 10万条记录
- `member_monthly_statistics`: 每月约100条记录（按区域统计）
- `member_crfme_scores`: 每月10万条记录
- `member_lifecycle_records`: 平均每个会员5条记录，共50万条
- `member_segmentation`: 每月10万条记录
- `member_activity_logs`: 每天约1万条活动记录
- `member_stage_monthly_stats`: 每月约50条记录（5个阶段×10个区域）

## 总结

设计了**7张数据表**来支持会员管理模块的完整功能：

1. **member_info** - 会员基础信息表
2. **member_monthly_statistics** - 会员月度统计表
3. **member_lifecycle_records** - 会员生命周期记录表
4. **member_crfme_scores** - CRFM-E评分表
5. **member_segmentation** - 会员分层表
6. **member_activity_logs** - 会员活动记录表
7. **member_stage_monthly_stats** - 会员月度阶段统计表

这些表能够完全支持会员管理页面的所有功能需求，包括月度查询、生命周期管理、CRFM-E模型分析和分层运营等。