# 前后端接口统一开发文档

## 项目概述

本文档基于雀巢MOT方法论系统的前后端代码分析，统一规范前后端接口的开发标准，确保接口的一致性和完整性。

## 前端页面分析

### 前端页面清单

1. **登录页面** (`login.html`)
2. **主仪表盘** (`index.html`)
3. **会员管理** (`member-management.html`)
4. **数据分析** (`data-analysis.html`)
5. **MOT管理** (`mot-management.html`)
6. **导购绩效** (`guide-performance.html`)
7. **企业微信运营** (`wechat-operation.html`)
8. **智能运营** (`smart-operation.html`)
9. **API测试页面** (`test-api.html`)

### 前端API需求统计

基于前端代码分析，共需要以下API接口：

#### 1. 系统接口 (System APIs)
- `GET /api/system/health` - 健康检查
- `GET /api/system/info` - 系统信息

#### 2. 认证接口 (Authentication APIs)
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户退出
- `POST /api/auth/verify-token` - 验证Token
- `POST /api/auth/refresh-token` - 刷新Token

#### 3. 仪表盘接口 (Dashboard APIs)
- `GET /api/dashboard/overview` - 仪表盘概览
- `GET /api/dashboard/metrics` - 核心指标
- `GET /api/dashboard/member-growth` - 会员增长趋势
- `GET /api/dashboard/sales-trend` - 销售趋势
- `GET /api/dashboard/mot-performance` - MOT绩效
- `GET /api/dashboard/recent-activities` - 最近活动

#### 4. 会员管理接口 (Member APIs)
- `GET /api/members/overview` - 会员概览
- `GET /api/members/list` - 会员列表
- `GET /api/members/{id}` - 会员详情
- `POST /api/members` - 创建会员
- `PUT /api/members/{id}` - 更新会员
- `DELETE /api/members/{id}` - 删除会员
- `GET /api/members/segments` - 会员分群
- `GET /api/members/statistics` - 会员统计
- `GET /api/members/importTemplate` - 下载会员导入模板
- `POST /api/members/importData` - 导入会员数据

#### 5. MOT管理接口 (MOT APIs)
- `GET /api/mot/tasks` - MOT任务列表
- `POST /api/mot/tasks` - 创建MOT任务
- `PUT /api/mot/tasks/{id}` - 更新MOT任务
- `DELETE /api/mot/tasks/{id}` - 删除MOT任务
- `GET /api/mot/tasks/{id}` - MOT任务详情
- `POST /api/mot/tasks/{id}/execute` - 执行MOT任务
- `GET /api/mot/statistics` - MOT统计数据

#### 6. 导购绩效接口 (Guide APIs)
- `GET /api/guide/list` - 导购列表
- `GET /api/guide/performance` - 导购绩效数据
- `GET /api/guide/detail/{id}` - 导购详情
- `POST /api/guide/create` - 创建导购
- `PUT /api/guide/update/{id}` - 更新导购信息
- `DELETE /api/guide/delete/{id}` - 删除导购
- `GET /api/guide/performance/statistics` - 导购绩效统计

#### 7. 企业微信运营接口 (WeChat APIs)
- `GET /api/wechat/overview` - 微信运营概览
- `GET /api/wechat/contacts` - 联系人列表
- `POST /api/wechat/messages/send` - 发送消息
- `GET /api/wechat/messages` - 消息记录
- `GET /api/wechat/groups` - 群组列表
- `POST /api/wechat/campaigns` - 创建营销活动
- `GET /api/wechat/campaigns` - 营销活动列表
- `GET /api/wechat/statistics` - 运营统计数据

#### 8. 数据分析接口 (Analytics APIs)
- `GET /api/analytics/sales-trend` - 销售趋势分析
- `GET /api/analytics/member-behavior` - 会员行为分析
- `GET /api/analytics/product-analysis` - 产品分析报告
- `GET /api/analytics/region-analysis` - 区域分析报告
- `GET /api/analytics/forecast` - 预测分析
- `POST /api/analytics/custom-report` - 生成自定义报告
- `GET /api/analytics/reports` - 报告列表

## 后端控制器分析

### 后端控制器清单

1. **SystemController** - 系统管理控制器
2. **AuthController** - 认证控制器
3. **DashboardController** - 仪表盘控制器
4. **MemberController** - 会员管理控制器
5. **MotController** - MOT管理控制器
6. **GuideController** - 导购绩效管理控制器
7. **WechatController** - 企业微信运营控制器
8. **AnalyticsController** - 数据分析控制器

### 后端接口实现统计

#### 1. SystemController
- ✅ `GET /system/health` - 健康检查

#### 2. AuthController
- ✅ `POST /auth/login` - 用户登录
- ✅ `POST /auth/logout` - 用户退出
- ✅ `POST /auth/verify-token` - 验证Token
- ✅ `POST /auth/refresh-token` - 刷新Token

#### 3. DashboardController
- ✅ `GET /dashboard/overview` - 仪表盘概览
- ✅ `GET /dashboard/metrics` - 核心指标
- ✅ `GET /dashboard/member-growth` - 会员增长趋势
- ✅ `GET /dashboard/sales-trend` - 销售趋势
- ✅ `GET /dashboard/mot-performance` - MOT绩效
- ✅ `GET /dashboard/recent-activities` - 最近活动

#### 4. MemberController
- ✅ `GET /members/overview` - 会员概览
- ✅ `GET /members/list` - 会员列表
- ✅ `GET /members/{id}` - 会员详情
- ✅ `POST /members` - 创建会员
- ✅ `PUT /members/{id}` - 更新会员
- ✅ `DELETE /members/{id}` - 删除会员
- ✅ `GET /members/segments` - 会员分群
- ✅ `GET /members/statistics` - 会员统计
- ✅ `GET /members/importTemplate` - 下载会员导入模板
- ✅ `POST /members/importData` - 导入会员数据

#### 5. MotController
- ✅ `GET /mot/tasks` - MOT任务列表
- ✅ `POST /mot/tasks` - 创建MOT任务
- ✅ `PUT /mot/tasks/{taskId}` - 更新MOT任务
- ✅ `DELETE /mot/tasks/{taskId}` - 删除MOT任务
- ✅ `GET /mot/tasks/{taskId}` - MOT任务详情
- ✅ `POST /mot/tasks/{taskId}/execute` - 执行MOT任务
- ✅ `GET /mot/statistics` - MOT统计数据

#### 6. GuideController
- ✅ `GET /guide/list` - 导购列表
- ✅ `GET /guide/performance` - 导购绩效数据
- ✅ `GET /guide/detail/{guideId}` - 导购详情
- ✅ `POST /guide/create` - 创建导购
- ✅ `PUT /guide/update/{guideId}` - 更新导购信息
- ✅ `DELETE /guide/delete/{guideId}` - 删除导购
- ✅ `GET /guide/performance/statistics` - 导购绩效统计

#### 7. WechatController
- ✅ `GET /wechat/overview` - 微信运营概览
- ✅ `GET /wechat/contacts` - 联系人列表
- ✅ `POST /wechat/messages/send` - 发送消息
- ✅ `GET /wechat/messages` - 消息记录
- ✅ `GET /wechat/groups` - 群组列表
- ✅ `POST /wechat/campaigns` - 创建营销活动
- ✅ `GET /wechat/campaigns` - 营销活动列表
- ✅ `GET /wechat/statistics` - 运营统计数据

#### 8. AnalyticsController
- ✅ `GET /analytics/sales-trend` - 销售趋势分析
- ✅ `GET /analytics/member-behavior` - 会员行为分析
- ✅ `GET /analytics/product-analysis` - 产品分析报告
- ✅ `GET /analytics/region-analysis` - 区域分析报告
- ✅ `GET /analytics/forecast` - 预测分析
- ✅ `POST /analytics/custom-report` - 生成自定义报告
- ✅ `GET /analytics/reports` - 报告列表

## 前后端接口映射关系

### 接口路径差异分析

前端期望的API路径格式：`/api/{module}/{action}`
后端实际的API路径格式：`/{module}/{action}`

**解决方案：**
1. 在后端添加统一的API前缀 `/api`
2. 或在前端配置中移除 `/api` 前缀

### 参数命名差异

| 前端参数名 | 后端参数名 | 建议统一 |
|-----------|-----------|----------|
| id | taskId/guideId | 统一使用 id |
| page | page | ✅ 一致 |
| size | size | ✅ 一致 |

## 会员导入功能详细说明

### 功能概述

会员导入功能允许用户通过Excel文件批量导入会员数据，支持新增和更新两种模式，提供完整的导入结果反馈和错误处理机制。

### 接口详情

#### 1. 下载导入模板接口

**接口地址：** `GET /api/member/importTemplate`

**功能描述：** 下载会员数据导入的Excel模板文件

**请求参数：** 无

**响应格式：** 直接返回Excel文件流

**模板字段说明：**
- **会员姓名*** (必填): 会员的真实姓名
- **手机号*** (必填): 会员手机号，作为唯一标识
- **邮箱**: 会员邮箱地址
- **生日**: 会员生日，格式：YYYY-MM-DD
- **性别**: 会员性别 (男/女)
- **地址**: 会员地址信息
- **注册时间**: 会员注册时间，格式：YYYY-MM-DD HH:mm:ss
- **会员等级**: 会员等级 (普通/银卡/金卡/钻石)
- **积分**: 会员当前积分
- **备注**: 其他备注信息

#### 2. 导入会员数据接口

**接口地址：** `POST /api/member/importData`

**功能描述：** 批量导入会员数据

**请求参数：**
- `file` (MultipartFile): Excel文件
- `updateSupport` (Boolean): 是否支持更新已存在的会员数据

**响应格式：**
```json
{
  "code": 200,
  "message": "导入完成",
  "data": {
    "totalCount": 100,
    "successCount": 95,
    "failCount": 5,
    "errorMessages": [
      "第2行：会员姓名不能为空",
      "第5行：手机号格式不正确",
      "第8行：手机号已存在且未开启更新模式"
    ]
  }
}
```

### 业务逻辑

#### 数据校验规则
1. **必填字段校验**: 会员姓名和手机号为必填字段
2. **格式校验**: 手机号格式、邮箱格式、日期格式等
3. **唯一性校验**: 手机号作为唯一标识，重复时根据更新模式处理
4. **数据长度校验**: 各字段长度限制

#### 导入模式
- **新增模式**: 只导入新会员，遇到重复手机号时跳过
- **更新模式**: 支持更新已存在会员的信息

#### 错误处理
- 记录每行数据的具体错误信息
- 提供详细的错误统计和错误列表
- 支持部分成功导入，失败数据不影响成功数据

### 前端实现

#### 用户界面
- **导入按钮**: 在会员列表页面提供"导入"按钮
- **模板下载**: 提供"下载模板"按钮
- **导入模态框**: 包含文件选择、更新选项和导入说明
- **结果展示**: 显示导入结果统计和错误详情

#### 交互流程
1. 用户点击"下载模板"获取Excel模板
2. 用户填写会员数据并保存Excel文件
3. 用户点击"导入"按钮，选择Excel文件
4. 用户选择是否允许更新已存在数据
5. 系统执行导入并显示结果

### 技术实现

#### 后端技术栈
- **Excel处理**: 使用Apache POI库处理Excel文件
- **数据校验**: 自定义校验规则和错误收集机制
- **事务管理**: 确保数据一致性
- **异常处理**: 完善的异常捕获和错误信息返回

#### 前端技术栈
- **文件上传**: 使用FormData进行文件上传
- **模态框**: Bootstrap Modal组件
- **结果展示**: 动态生成统计卡片和错误列表
- **用户体验**: 加载状态、进度提示等

### 性能考虑

#### 数据量限制
- 建议单次导入不超过1000条数据
- 大文件导入时提供进度提示
- 超时处理和错误恢复机制

#### 内存优化
- 流式处理Excel文件
- 分批处理数据库操作
- 及时释放资源

### 安全考虑

#### 文件安全
- 限制上传文件类型(.xlsx, .xls)
- 文件大小限制
- 文件内容安全检查

#### 数据安全
- 敏感信息处理
- 操作日志记录
- 权限控制

## 接口开发规范

### 1. URL设计规范

- **基础路径：** `/api/v1/{module}`
- **资源命名：** 使用复数形式（如 `/members`）
- **操作规范：**
  - GET：查询操作
  - POST：创建操作
  - PUT：更新操作
  - DELETE：删除操作

### 2. 请求参数规范

#### 查询参数
```json
{
  "page": 1,
  "size": 10,
  "sort": "createTime",
  "order": "desc",
  "filters": {
    "status": "active",
    "type": "premium"
  }
}
```

#### 路径参数
- 使用 `{id}` 表示资源ID
- 保持参数名称一致性

### 3. 响应格式规范

#### 成功响应
```json
{
  "code": 200,
  "message": "success",
  "data": {
    // 具体数据
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

#### 分页响应
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [],
    "total": 100,
    "page": 1,
    "size": 10,
    "pages": 10
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

#### 错误响应
```json
{
  "code": 400,
  "message": "参数错误",
  "error": "详细错误信息",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

### 4. 状态码规范

| 状态码 | 含义 | 使用场景 |
|--------|------|----------|
| 200 | 成功 | 请求成功 |
| 201 | 已创建 | 资源创建成功 |
| 400 | 请求错误 | 参数错误 |
| 401 | 未授权 | 需要登录 |
| 403 | 禁止访问 | 权限不足 |
| 404 | 未找到 | 资源不存在 |
| 500 | 服务器错误 | 内部错误 |

### 5. 安全规范

#### 认证机制
- 使用JWT Token进行身份验证
- Token在Header中传递：`Authorization: Bearer {token}`

#### 权限控制
- 基于角色的访问控制（RBAC）
- 接口级别的权限验证

#### 数据验证
- 输入参数验证
- SQL注入防护
- XSS攻击防护

## 开发建议

### 1. 前端开发建议

1. **API配置统一管理**
   - 将所有API配置集中在 `api.js` 文件中
   - 使用环境变量管理不同环境的API地址

2. **错误处理统一**
   - 实现全局错误处理机制
   - 统一错误提示样式

3. **加载状态管理**
   - 为所有API调用添加加载状态
   - 实现统一的Loading组件

### 2. 后端开发建议

1. **接口文档自动生成**
   - 使用Swagger生成API文档
   - 保持文档与代码同步

2. **日志记录规范**
   - 记录关键操作日志
   - 统一日志格式

3. **性能优化**
   - 实现接口缓存机制
   - 数据库查询优化

### 3. 测试建议

1. **单元测试**
   - 为每个Controller编写单元测试
   - 测试覆盖率不低于80%

2. **集成测试**
   - 前后端接口联调测试
   - 自动化测试脚本

## 总结

### 接口统计汇总

- **前端需要接口数量：** 44个
- **后端已实现接口数量：** 44个
- **接口覆盖率：** 100%

### 主要问题与解决方案

1. **路径前缀不一致**
   - 问题：前端使用 `/api` 前缀，后端没有
   - 解决：统一添加 `/api` 前缀

2. **参数命名不一致**
   - 问题：部分接口参数名称不统一
   - 解决：制定统一的参数命名规范

3. **响应格式需要标准化**
   - 问题：响应格式不够统一
   - 解决：实现统一的响应包装器

### 下一步工作

1. 根据本文档调整前后端接口实现
2. 完善接口文档和测试用例
3. 建立接口变更管理流程
4. 实施接口监控和性能优化

---

**文档版本：** v1.0  
**创建时间：** 2024-01-15  
**维护人员：** 开发团队  
**更新频率：** 根据项目需要及时更新